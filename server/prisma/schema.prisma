generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String     @id @default(cuid())
  name               String
  email              String     @unique
  password           String?
  profilePicture     String?
  isActive           Boolean    @default(true)
  lastLogin          DateTime?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  CurrentWorkspace   Workspace? @relation(fields: [currentWorkspaceId], references: [id])
  currentWorkspaceId String?
  Project            Project[]
  TaskCreated        Task[]     @relation("TaskCreatedBy")
  TaskAssigned       Task[]     @relation("TaskAssignedTo")
  Member             Member[]
  Account            Account[]
  Workspace          Workspace? @relation("UserWorkspace")
}

model Account {
  id           String       @id @default(cuid())
  User         User         @relation(fields: [userId], references: [id])
  userId       String
  provider     ProviderEnum
  providerId   String       @unique
  refreshToken String?
  tokenExpiry  DateTime?
}

model Workspace {
  id          String    @id @default(cuid())
  name        String
  description String?
  inviteCode  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Project     Project[]
  Task        Task[]
  Member      Member[]
  Owner       User      @relation("UserWorkspace", fields: [ownerId], references: [id])
  ownerId     String    @unique
  User        User[]
}

model Project {
  id          String    @id @default(cuid())
  name        String
  emoji       String    @default("ðŸ“Š")
  description String?
  Workspace   Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId String
  CreatedBy   User      @relation(fields: [createdById], references: [id])
  createdById String
  CreatedAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Task        Task[]
}

model Task {
  id           String           @id @default(cuid())
  taskCode     String
  title        String
  description  String?
  Project      Project          @relation(fields: [projectId], references: [id])
  projectId    String
  Workspace    Workspace        @relation(fields: [workspaceId], references: [id])
  workspaceId  String
  AssignedTo   User             @relation("TaskAssignedTo", fields: [assignedToId], references: [id])
  assignedToId String
  CreatedBy    User             @relation("TaskCreatedBy", fields: [createdById], references: [id])
  createdById  String
  status       TaskStatusEnum   @default(TODO)
  priority     TaskPriorityEnum @default(MEDIUM)
  dueDate      DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
}

model Member {
  id          String     @id @default(cuid())
  User        User?      @relation(fields: [userId], references: [id])
  userId      String?
  Workspace   Workspace? @relation(fields: [workspaceId], references: [id])
  workspaceId String?
  Role        Role?      @relation(fields: [roleId], references: [id])
  roleId      String?
  joinedAt    DateTime   @default(now())
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Role {
  id         String       @id @default(cuid())
  name       RoleTypeEnum @unique
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  Permission Permission[] @relation("RolePermissions")
  Member     Member[]
}

model Permission {
  id   String             @id @default(cuid())
  type PermissionTypeEnum @unique
  Role Role[]             @relation("RolePermissions")
}

enum RoleTypeEnum {
  OWNER
  ADMIN
  MEMBER
}

enum PermissionTypeEnum {
  CREATE_WORKSPACE
  DELETE_WORKSPACE
  EDIT_WORKSPACE
  MANAGE_WORKSPACE_SETTINGS
  ADD_MEMBER
  CHANGE_MEMBER_ROLE
  REMOVE_MEMBER
  CREATE_PROJECT
  EDIT_PROJECT
  DELETE_PROJECT
  CREATE_TASK
  EDIT_TASK
  DELETE_TASK
  VIEW_ONLY
}

enum TaskStatusEnum {
  TODO
  IN_PROGRESS
  DONE
}

enum TaskPriorityEnum {
  LOW
  MEDIUM
  HIGH
}

enum ProviderEnum {
  GOOGLE
  EMAIL
}
